
include("model.jl")

L = 100
sweep = range(-1.5,stop=1.5,length=L)
# sweep = range(-200.0,stop=200.0,length=L)

ws = 11.0
sep = 10.0

# turbulence_intensity = 0.046
turbulence_intensity = 0.11
ky = 0.025
kz = 0.025
alpha_star = 5.0
beta_star = 0.4
# alpha_star = 2.32
# beta_star = 0.154
horizontal_spread_rate = ky
vertical_spread_rate = kz

# wakedeficitmodel = ff.GaussYaw(turbulence_intensity,horizontal_spread_rate,vertical_spread_rate,alpha_star,beta_star)
wakedeficitmodel = ff.GaussYaw(horizontal_spread_rate,vertical_spread_rate,alpha_star,beta_star,1.0)
wakedeflectionmodel = ff.JiminezYawDeflection(horizontal_spread_rate)
ms = ff.WindFarmModelSet(wakedeficitmodel, wakedeflectionmodel, wakecombinationmodel,local_ti_model)

windspeeds = [ws]
windfarm = ff.WindFarm(turbine_x, turbine_y, turbine_z, turbine_definition_ids, turbine_definitions)
init_inflow_velcities = zeros(nturbines) .+ wind_speed
windfarmstate = ff.SingleWindFarmState(1, turbine_x, turbine_y, turbine_z, turbine_yaw, turbine_ct, turbine_ai, init_inflow_velcities, zeros(nturbines),zeros(nturbines).+ambient_ti,sorted_turbine_index)
windresource = ff.DiscretizedWindResource(winddirections, windspeeds, windprobabilities, measurementheight, air_density, ambient_ti, [wind_shear_model])
pd = ff.WindFarmProblemDescription(windfarm, windresource, [windfarmstate])


U_model = zeros(L)
for i = 1:L
    loc = [sep*rotor_diameter,sweep[i]*rotor_diameter,hub_height]
    U_model[i] = ff.point_velocity(loc, ms, pd)
end


U4 = [10.982978327876998, 11.004565254126359, 11.02585783171067, 11.0485931928388, 11.07293170856613, 11.098683812946877, 11.107096103304562, 11.114810930745993, 11.117501637985704, 11.106158479196445, 11.094366816526968, 11.087193031729242, 11.08162894017074, 11.076376509839175, 11.0805527115551, 11.084841444224137, 11.08418491768436, 11.077501659776516, 11.07242597963307, 11.048296430697608, 11.022473359578475, 10.994272368235327, 10.958245603237657, 10.92386333306891, 10.863791672220483, 10.790962149465576, 10.718218466338252, 10.545334594882348, 10.37277522510844, 10.162618255645983, 9.89082089624214, 9.627020910321509, 9.320701310755034, 9.00973584970292, 8.701191222508156, 8.387219708214602, 8.070814949842987, 7.816140073174736, 7.600198652545017, 7.3772795002138265, 7.303023677875945, 7.229267533650562, 7.177111088638997, 7.173617205948367, 7.1649306193958715, 7.177580425711747, 7.1943645536702325, 7.20621135338884, 7.194350272555969, 7.183280362271231, 7.143900314520721, 7.08087996612525, 7.019486659577743, 6.9620499162140375, 6.906193888628875, 6.8743317744389145, 6.898780526637663, 6.9172506779389, 7.01773337710016, 7.143655223668076, 7.277226297650731, 7.517929698732475, 7.757795534362021, 8.036858363160428, 8.360678660936529, 8.679388512763897, 9.02229732866094, 9.365490580638745, 9.693605395435597, 9.980311002864987, 10.271900506842826, 10.477440257406716, 10.645889091679464, 10.812887985830075, 10.904676094297525, 10.99690551715319, 11.071280912207252, 11.117523940908388, 11.167927358781617, 11.184782054044282, 11.197438025025264, 11.20934837764427, 11.215761451028737, 11.222241773289012, 11.229319737728025, 11.236709934848285, 11.244282268212542, 11.246629622800532, 11.248947502102435, 11.250874215083567, 11.251882352238887, 11.252608147951156, 11.254995589885876, 11.257678646745966, 11.260111976661886, 11.262598001584422, 11.264788008988006, 11.26770481651768, 11.27143331898097, 11.27520598149523]


U7 = [10.955507520692134, 10.965821342361288, 10.975777400755439, 10.9933877511089, 11.017931190154837, 11.04285337723238, 11.060095066495162, 11.077028879727829, 11.089198785343946, 11.077329736245407, 11.068035862253536, 11.057888704763922, 11.047379267747127, 11.037506112260575, 11.03770231801364, 11.038025542486613, 11.032229641023644, 11.018911811817098, 11.007096093591727, 10.977287115047147, 10.946124526786058, 10.91099538542324, 10.86211340488067, 10.815884628503028, 10.737150450180248, 10.643129779420416, 10.549275286247509, 10.41529254462774, 10.281277113054887, 10.1476659740456, 10.013374184280838, 9.881865372484432, 9.729116944984895, 9.57324740659505, 9.4137260179213, 9.223905931500775, 9.034087700607289, 8.85289728631355, 8.674779223707946, 8.495602159828323, 8.352529414509654, 8.20988156595644, 8.077139793802978, 7.966088520037428, 7.852158811240493, 7.7637358900076565, 7.68073344595924, 7.601637802694947, 7.555737058965987, 7.509260537260738, 7.485451236627247, 7.484935303458281, 7.480535688837448, 7.518081889654293, 7.557142847033806, 7.609488878618345, 7.698625384956711, 7.784336449987527, 7.903214132239573, 8.032463093553439, 8.16410350537304, 8.3525086405383, 8.540223835498349, 8.747753332422942, 8.980334827372682, 9.215044542026213, 9.423427849083625, 9.629792776136286, 9.827196258880772, 9.99655991209825, 10.167635024367017, 10.314517702733776, 10.451640261404743, 10.588232994260089, 10.686435687224508, 10.784738260949537, 10.866807772602991, 10.924922743936666, 10.985381591879253, 11.020098294820324, 11.051554155489534, 11.08205494422274, 11.107197077475, 11.13264856929372, 11.155345685385008, 11.176133834773161, 11.19756660785888, 11.201562308185265, 11.205397888048031, 11.205827599721037, 11.199554608631411, 11.193519781075317, 11.185313871416563, 11.176693884573975, 11.16883977730857, 11.167273381133905, 11.165485223639118, 11.168179962379337, 11.17443308908145, 11.18043648651415]


U10 = [10.943638405497524, 10.950903797357892, 10.958901180234806, 10.96964431308455, 10.983728651871827, 10.997639926470224, 11.008159242199726, 11.018224262868143, 11.025754542883742, 11.020401795296747, 11.01635349749996, 11.013004547284279, 11.010013643968943, 11.006946121220999, 10.993367948768027, 10.98022449974791, 10.959963942505054, 10.927861221066838, 10.896604394574211, 10.869046651736287, 10.84224989714536, 10.813879302723546, 10.772883625342041, 10.733134758884237, 10.670240641487057, 10.592091929631595, 10.514054163778843, 10.42606113602971, 10.338028702552844, 10.249547180975728, 10.16002469247852, 10.070591597349333, 9.982075424298767, 9.893827770049771, 9.805890950185699, 9.722327572099351, 9.638371245879833, 9.541884422539574, 9.434470105622593, 9.32735036762716, 9.207902044886215, 9.087710609598094, 8.966668800789575, 8.842826526635585, 8.719252285044892, 8.622073211502046, 8.535106544176744, 8.4498156096221, 8.415285534770925, 8.377046011233483, 8.350725431831876, 8.338413264326048, 8.325412149726263, 8.353250831015625, 8.386189861915895, 8.42797009192387, 8.512546881806257, 8.592799300077827, 8.688582063167669, 8.792095519918295, 8.895802153961691, 9.020575842913905, 9.1443921876256, 9.270265263623687, 9.399428010004241, 9.52836249834557, 9.64678392233307, 9.763136716503613, 9.88126103406023, 10.012784304384082, 10.142971956437961, 10.265339659396197, 10.382708633315788, 10.500103929424617, 10.574230050115041, 10.648481896701494, 10.715189338258376, 10.765152621690943, 10.816541859206723, 10.855289346259067, 10.890495288771668, 10.925215294809478, 10.953591182915115, 10.982548402611311, 11.009102650713476, 11.033617011024068, 11.058180395425897, 11.062686723946214, 11.066117974437224, 11.068044257862013, 11.065240094424443, 11.0628892805124, 11.064539398205916, 11.06768746437068, 11.070819606639551, 11.07351811624454, 11.076249011788116, 11.081542049139507, 11.089735303663122, 11.097792612185707]

# if sep == 4.0
#         plot(sweep,U4)
# elseif sep == 7.0
#         plot(sweep,U7)
# elseif sep == 10.0
#         plot(sweep,U10)
# end
plot(sweep,U_model)
