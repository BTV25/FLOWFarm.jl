
include("model.jl")

L = 100
sweep = range(-1.5,stop=1.5,length=L)
# sweep = range(-200.0,stop=200.0,length=L)

ws = 11.0
ti = "high"
sep = 10.0

# ky = 0.015
# kz = 0.015
# alpha_star = 5.0
# beta_star = 0.5
ky = 0.035
kz = 0.035
alpha_star = 6.5
beta_star = 0.8
# alpha_star = 2.32
# beta_star = 0.154
horizontal_spread_rate = ky
vertical_spread_rate = kz

wakedeficitmodel = ff.GaussYaw(horizontal_spread_rate,vertical_spread_rate,alpha_star,beta_star,1.0)
# wakedeficitmodel = ff.GaussYawVariableSpread(alpha_star,beta_star,1.0)
wakedeflectionmodel = ff.JiminezYawDeflection(horizontal_spread_rate)
ms = ff.WindFarmModelSet(wakedeficitmodel, wakedeflectionmodel, wakecombinationmodel,local_ti_model)

turbine_x = [0.0,sep*rotor_diameter]
windspeeds = [ws]
windfarm = ff.WindFarm(turbine_x, turbine_y, turbine_z, turbine_definition_ids, turbine_definitions)
init_inflow_velcities = zeros(nturbines) .+ wind_speed
windfarmstate = ff.SingleWindFarmState(1, turbine_x, turbine_y, turbine_z, turbine_yaw, turbine_ct, turbine_ai, init_inflow_velcities, zeros(nturbines),zeros(nturbines).+ambient_ti,sorted_turbine_index)
windresource = ff.DiscretizedWindResource(winddirections, windspeeds, windprobabilities, measurementheight, air_density, ambient_ti, [wind_shear_model])
pd = ff.WindFarmProblemDescription(windfarm, windresource, [windfarmstate])


U_model = zeros(L)
sweep_x = range(0.0,stop=12.0,length=L)
for i = 1:L
    loc = [sep*rotor_diameter,sweep[i]*rotor_diameter,hub_height]
    # loc = [sweep_x[i]*rotor_diameter,0.0,hub_height]
    U_model[i] = ff.point_velocity(loc, ms, pd)
end


if ti == "low"
       """low TI new"""
       U4 = [10.63505497, 10.6545201 , 10.66609849, 10.67753429, 10.67515641,
              10.66862232, 10.6910736 , 10.71348075, 10.75082224, 10.78072874,
              10.79965334, 10.81880293, 10.83306464, 10.85657096, 10.85767905,
              10.85927679, 10.84079795, 10.82310788, 10.8203721 , 10.81744927,
              10.82166674, 10.82191965, 10.83230302, 10.84231727, 10.86088841,
              10.87951574, 10.89387066, 10.90852909, 10.91354182, 10.89748298,
              10.90267132, 10.9077521 , 10.93176393, 10.91719307, 10.90840192,
              10.8993762 , 10.908071  , 10.90298994, 10.88820278, 10.87342018,
              10.84609842, 10.8388823 , 10.80646668, 10.77384753, 10.68922344,
              10.62008721, 10.49159457, 10.36291749, 10.16529548,  9.92460624,
               9.67694274,  9.43067018,  9.20357835,  8.86630526,  8.62768088,
               8.39152906,  8.27365105,  8.07327164,  7.87611521,  7.6800449 ,
               7.48111888,  7.2109831 ,  7.07806033,  6.94487141,  6.93704054,
               6.87233784,  6.84422697,  6.81455094,  6.80825996,  6.84421551,
               6.84138522,  6.83708589,  6.78058898,  6.81334329,  6.82147888,
               6.8282187 ,  6.79626576,  6.8410014 ,  6.81791231,  6.79272442,
               6.71462192,  6.67826737,  6.61687734,  6.55572234,  6.49157141,
               6.45342235,  6.41529639,  6.38003895,  6.33974747,  6.30752421,
               6.32883671,  6.35194446,  6.42903019,  6.50634712,  6.59159249,
               6.6787166 ,  6.78291504,  6.91835783,  7.069963  ,  7.22352261,
               7.39372804,  7.58079624,  7.78870599,  7.99522003,  8.22571212,
               8.46669479,  8.70650312,  8.94369186,  9.16489568,  9.43809802,
               9.63941199,  9.83901587,  9.95618287, 10.12501439, 10.23162638,
              10.33761888, 10.40570042, 10.49023084, 10.54972666, 10.60947564,
              10.65088783, 10.68552095, 10.72861675, 10.77185231, 10.80728731,
              10.83676403, 10.86333341, 10.88955922, 10.90746657, 10.92516384,
              10.93541943, 10.94512268, 10.95733265, 10.98216734, 10.99592857,
              11.00967027, 11.01716924, 11.04469427, 11.05948297, 11.07445476,
              11.07072104, 11.07181356, 11.07433954, 11.07724106, 11.07717353,
              11.05392433, 11.07462781, 11.09559978, 11.16509263, 11.20724175,
              11.24081371, 11.27323332, 11.29887136, 11.32090975, 11.3357319 ,
              11.34991146, 11.34916375, 11.35779719, 11.36192775, 11.36640456,
              11.36989697]
       U7 = [10.61348953, 10.6258653 , 10.62722991, 10.62859451, 10.62208988,
              10.62215162, 10.63111886, 10.6400861 , 10.66295345, 10.6898767 ,
              10.71217496, 10.73447322, 10.75820921, 10.78339349, 10.80457663,
              10.82575978, 10.84110485, 10.85914574, 10.85600282, 10.8528599 ,
              10.82827603, 10.80153263, 10.79010797, 10.7786833 , 10.79116706,
              10.79289314, 10.80268126, 10.81246938, 10.82779562, 10.83079227,
              10.83443202, 10.83807178, 10.83349971, 10.81737563, 10.81278369,
              10.80819175, 10.81153786, 10.80752401, 10.78650653, 10.76548905,
              10.72072825, 10.66265552, 10.59834223, 10.53402894, 10.46582752,
              10.37150511, 10.28117628, 10.19084745, 10.11759816, 10.03033791,
               9.94072905,  9.85112018,  9.77556866,  9.74219912,  9.61404845,
               9.48589779,  9.3079883 ,  9.21705688,  9.0617655 ,  8.90647412,
               8.70228208,  8.54054019,  8.42512493,  8.30970967,  8.20329401,
               8.0643344 ,  7.98170595,  7.89907751,  7.84545921,  7.72427857,
               7.64274923,  7.56121988,  7.51193564,  7.4175781 ,  7.33601001,
               7.25444191,  7.19187194,  7.13009121,  7.06489577,  6.99970034,
               6.93048746,  6.87524643,  6.84910055,  6.82295468,  6.81729278,
               6.798744  ,  6.80539004,  6.81203609,  6.85030994,  6.84063008,
               6.88799504,  6.93536   ,  7.05939866,  7.14386002,  7.25127357,
               7.35868712,  7.50651763,  7.6680194 ,  7.84722701,  8.02643463,
               8.20054423,  8.4265615 ,  8.61904552,  8.81152954,  8.93577284,
               9.10195799,  9.22509877,  9.34823955,  9.4136146 ,  9.50370903,
               9.59505957,  9.6864101 ,  9.76782947,  9.86130074,  9.9564045 ,
              10.05150826, 10.1497903 , 10.25605094, 10.34172269, 10.42739444,
              10.49183211, 10.56738589, 10.61282785, 10.65826981, 10.67234919,
              10.68965541, 10.69929319, 10.70893097, 10.72634811, 10.74472271,
              10.75497982, 10.76523692, 10.77219988, 10.79358685, 10.81491691,
              10.83624697, 10.84909592, 10.86904563, 10.88260606, 10.89616649,
              10.90575967, 10.91618871, 10.92439385, 10.93259899, 10.94494466,
              10.96199024, 10.96789917, 10.97380809, 10.97923263, 10.99754485,
              10.99209767, 10.98665049, 10.97102343, 10.97108863, 10.98460853,
              10.99812842, 11.01808133, 11.05108311, 11.07827695, 11.10547079,
              11.11206859]
       U10 = [10.52964212, 10.52294289, 10.51624604, 10.50954919, 10.50392041,
              10.50651213, 10.50910994, 10.51170774, 10.51862782, 10.54921307,
              10.5798077 , 10.61040234, 10.63759806, 10.67827585, 10.71895625,
              10.75963664, 10.78921975, 10.8083248 , 10.82742239, 10.84651998,
              10.85954127, 10.86172073, 10.86390112, 10.86608151, 10.8730946 ,
              10.86196686, 10.85082833, 10.83968981, 10.83906748, 10.81364795,
              10.78822081, 10.76279367, 10.7478222 , 10.73758495, 10.72735209,
              10.71711924, 10.70433033, 10.68626458, 10.66818829, 10.65011201,
              10.6188216 , 10.54910684, 10.47937837, 10.40964991, 10.35099303,
              10.26378189, 10.17655758, 10.08933328, 10.02244191,  9.93873564,
               9.85502306,  9.77131048,  9.69393126,  9.6222543 ,  9.55058829,
               9.47892228,  9.41187772,  9.36374784,  9.31561592,  9.26748401,
               9.21558841,  9.14369014,  9.07177752,  8.9998649 ,  8.92351602,
               8.80631633,  8.68910248,  8.57188862,  8.47160582,  8.3622922 ,
               8.25298786,  8.14368353,  8.05325187,  7.99543026,  7.93762632,
               7.87982237,  7.80692084,  7.77358464,  7.74025392,  7.70692321,
               7.64562798,  7.61459981,  7.5835877 ,  7.5525756 ,  7.50728995,
               7.51252632,  7.51779661,  7.5230669 ,  7.53082451,  7.60101694,
               7.6712292 ,  7.74144145,  7.81945194,  7.91246958,  8.00548851,
               8.09850743,  8.18304981,  8.28307459,  8.38310952,  8.48314446,
               8.57109677,  8.67655634,  8.78201689,  8.88747744,  9.00774451,
               9.1064973 ,  9.20524136,  9.30398542,  9.41255399,  9.51526507,
               9.61796917,  9.72067326,  9.78962596,  9.88007037,  9.97052334,
              10.06097631, 10.12471002, 10.18178281, 10.23885202, 10.29592122,
              10.35503033, 10.38210666, 10.40917322, 10.43623979, 10.46629052,
              10.48287709, 10.49945332, 10.51602954, 10.54203115, 10.56151125,
              10.58099066, 10.60047007, 10.62421591, 10.63204413, 10.63986226,
              10.64768038, 10.65811552, 10.65147652, 10.64483476, 10.638193  ,
              10.64767687, 10.65799028, 10.66830631, 10.67862234, 10.69672926,
              10.71785716, 10.73898558, 10.76011401, 10.77906644, 10.78219507,
              10.78531253, 10.78843   , 10.79914953, 10.80195374, 10.80476244,
              10.80757114, 10.81720867, 10.84818838, 10.87917683, 10.91016527,
              10.92748269]
elseif ti == "high"
       U4 = [11.83759319, 11.85408316, 11.85864704, 11.8626296 , 11.85922049,
              11.86892608, 11.86613146, 11.86372322, 11.84834082, 11.86238219,
              11.86729821, 11.87355509, 11.87274216, 11.92109891, 11.91751504,
              11.91453117, 11.85450853, 11.83586038, 11.82416856, 11.81168165,
              11.79117029, 11.76715821, 11.76185004, 11.75555216, 11.76971592,
              11.76674155, 11.77662996, 11.78679573, 11.81044879, 11.81839005,
              11.83438427, 11.85059339, 11.87828425, 11.89422777, 11.89877799,
              11.90325945, 11.90843269, 11.92237408, 11.91465432, 11.90745998,
              11.88280123, 11.86174995, 11.80024051, 11.73774318, 11.62514043,
              11.4664349 , 11.34625223, 11.22594548, 11.14447126, 10.98850753,
              10.84881921, 10.71228836, 10.59634217, 10.40911857, 10.25303291,
              10.09790702,  9.96394731,  9.6905654 ,  9.55548088,  9.41986768,
               9.43034782,  9.25225156,  9.14722798,  9.04213537,  9.02392284,
               8.92393704,  8.83690466,  8.74903473,  8.66804352,  8.67062684,
               8.57702134,  8.48505811,  8.27406356,  8.15834714,  8.03015541,
               7.90405113,  7.76240424,  7.61424483,  7.51539565,  7.41453402,
               7.36095163,  7.22816351,  7.18635846,  7.14105712,  7.1782126 ,
               7.14804141,  7.13174192,  7.11487631,  7.11883997,  7.08857149,
               7.06315243,  7.03902589,  7.03862412,  7.01880458,  7.01556442,
               7.01408742,  7.03016313,  7.01188468,  7.0876009 ,  7.1635164 ,
               7.32645642,  7.4065058 ,  7.5606539 ,  7.71185349,  7.95888797,
               8.16510219,  8.36625986,  8.56547027,  8.77297891,  9.01492677,
               9.18143248,  9.34808269,  9.43851056,  9.58947519,  9.7028105 ,
               9.81614926,  9.89311785, 10.01928723, 10.11893947, 10.21881479,
              10.2901148 , 10.37844204, 10.45343462, 10.52961283, 10.57828806,
              10.63536377, 10.66264569, 10.69145347, 10.66506754, 10.6534725 ,
              10.64784459, 10.6431442 , 10.64709987, 10.63169037, 10.62927654,
              10.62645476, 10.65543343, 10.63202562, 10.66208941, 10.6916346 ,
              10.7699632 , 10.80089118, 10.83935857, 10.87819827, 10.91570164,
              10.92809085, 10.93480252, 10.94092719, 10.94384025, 10.94779038,
              10.94409568, 10.93997514, 10.93570665, 10.94031596, 10.94497917,
              10.95075144, 10.96282776, 10.99824389, 11.02474815, 11.05067263,
              11.06085614]
       U7 = [11.84116179, 11.83156722, 11.84290973, 11.85425224, 11.87880396,
              11.90088905, 11.90378291, 11.90667677, 11.89881979, 11.90580427,
              11.89299605, 11.88018782, 11.85347615, 11.85002798, 11.84956432,
              11.84910066, 11.84479053, 11.86956267, 11.88274357, 11.89592448,
              11.90355763, 11.93254345, 11.93604364, 11.93954383, 11.9269466 ,
              11.93128314, 11.92596879, 11.92065444, 11.90128461, 11.88657295,
              11.89596267, 11.90535238, 11.92043259, 11.91795143, 11.91457852,
              11.91120561, 11.91199759, 11.89652409, 11.87629964, 11.8560752 ,
              11.84264867, 11.81766499, 11.77751282, 11.73736065, 11.67439359,
              11.60265664, 11.5121502 , 11.42164376, 11.32904169, 11.21052927,
              11.13198989, 11.05345051, 11.03937187, 11.00459313, 10.90979011,
              10.81498708, 10.67141053, 10.53555745, 10.40217703, 10.2687966 ,
              10.1378496 , 10.01478635,  9.91133679,  9.80788723,  9.70102405,
               9.61344765,  9.5498098 ,  9.48617195,  9.42250853,  9.40419977,
               9.30521787,  9.20623597,  9.03525797,  8.87567481,  8.76922839,
               8.66278197,  8.62550143,  8.55956754,  8.53052931,  8.50149108,
               8.4941037 ,  8.47193051,  8.4653411 ,  8.45875169,  8.46588807,
               8.4720788 ,  8.48596662,  8.49985445,  8.51510314,  8.51664358,
               8.52600994,  8.5353763 ,  8.53142756,  8.48673043,  8.48296444,
               8.47919844,  8.51872872,  8.47650262,  8.48148935,  8.48647608,
               8.53546695,  8.4928972 ,  8.5031568 ,  8.5134164 ,  8.60616542,
               8.64537104,  8.70777918,  8.77018732,  8.8840221 ,  9.00331676,
               9.09902515,  9.19473354,  9.24596174,  9.29283215,  9.40928354,
               9.52573492,  9.7026871 ,  9.82236034,  9.96223328, 10.10210622,
              10.25222371, 10.38606698, 10.46672325, 10.54737951, 10.5715913 ,
              10.64365007, 10.67034946, 10.69704886, 10.68126268, 10.71104309,
              10.73627496, 10.76150683, 10.7776959 , 10.78345985, 10.79958256,
              10.81570527, 10.85331968, 10.8686941 , 10.87657828, 10.88446247,
              10.89068054, 10.92354767, 10.95333962, 10.98313157, 11.00348829,
              11.07544608, 11.11403288, 11.15261967, 11.15906051, 11.20649367,
              11.22002597, 11.23355827, 11.21481683, 11.21047479, 11.20279336,
              11.19511194, 11.1776976 , 11.13724487, 11.14408059, 11.15091632,
              11.20310174]
       U10 = [11.98364745, 11.97778896, 11.9719195 , 11.96605004, 11.96742096,
              11.94888644, 11.93034725, 11.91180806, 11.89681156, 11.87286442,
              11.84891227, 11.82496012, 11.80487815, 11.79155418, 11.77823984,
              11.7649255 , 11.74473709, 11.75220516, 11.75968306, 11.76716096,
              11.76797863, 11.77385686, 11.77973051, 11.78560415, 11.79545997,
              11.79910348, 11.80274427, 11.80638506, 11.81225672, 11.8289123 ,
              11.84557269, 11.86223308, 11.87340849, 11.87762217, 11.88182723,
              11.8860323 , 11.89173613, 11.89420128, 11.89666924, 11.8991372 ,
              11.90534894, 11.89418685, 11.88301492, 11.87184299, 11.86347636,
              11.80576895, 11.74804159, 11.69031422, 11.63357371, 11.564783  ,
              11.49599121, 11.42719941, 11.36208247, 11.29577359, 11.22946296,
              11.16315232, 11.10591839, 11.03404276, 10.96216346, 10.89028417,
              10.83335563, 10.76192089, 10.69046952, 10.61901815, 10.56344773,
              10.49182103, 10.4201977 , 10.34857438, 10.27711019, 10.22606388,
              10.1750341 , 10.12400433, 10.06801002, 10.02819595,  9.98837705,
               9.94855816,  9.88841744,  9.84951182,  9.8106267 ,  9.77174159,
               9.70956385,  9.6795446 ,  9.64952825,  9.6195119 ,  9.59081286,
               9.57393089,  9.55705812,  9.54018534,  9.52345822,  9.53021829,
               9.53699435,  9.54377042,  9.53837185,  9.54812681,  9.55788154,
               9.56763627,  9.58319039,  9.58869847,  9.59419394,  9.5996894 ,
               9.6197818 ,  9.63304373,  9.64630914,  9.65957455,  9.68845481,
               9.70874199,  9.7290229 ,  9.7493038 ,  9.75956531,  9.77423917,
               9.78891603,  9.8035929 ,  9.80675396,  9.85176423,  9.8967924 ,
               9.94182057,  9.99756863, 10.05132395, 10.10506942, 10.15881488,
              10.21447474, 10.2271505 , 10.23981864, 10.25248679, 10.26472742,
              10.30030093, 10.33589708, 10.37149324, 10.39267643, 10.45452951,
              10.51638555, 10.5782416 , 10.62836904, 10.6445072 , 10.66062592,
              10.67674465, 10.71615363, 10.69761174, 10.67904843, 10.66048511,
              10.67502979, 10.66352442, 10.65202165, 10.64051889, 10.64613555,
              10.65192264, 10.65770345, 10.66348425, 10.66085968, 10.67335717,
              10.68586719, 10.6983772 , 10.68090213, 10.70594463, 10.7310051 ,
              10.75606557, 10.75828822, 10.79840957, 10.83854347, 10.87867736,
              10.91017861]
end
sweep_dat = range(-1.5,stop=1.5,length=length(U4))
if sep == 4.0
        plot(sweep_dat,U4)
        # plot(sweep,U41)
elseif sep == 7.0
        plot(sweep_dat,U7)
elseif sep == 10.0
        plot(sweep_dat,U10)
end

plot(sweep,U_model)
ylim(5.5,12.5)
xlabel("offset (D)")
ylabel("wind speed (m/s)")
title(sep)
# plot(sweep_x,U_model)
